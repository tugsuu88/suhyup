<%/******************************************************************************Title			: board_del_proc.jsp*@author		: K.H.S*@date			: 2007-11*@Description	: 게시판01 자료 삭제 DB처리*@Copyright		:*******************************************************************************수정일		*수정자		*수정사유******************************************************************************/%><%@ page import="java.util.*, java.text.*, java.io.*, util.*" contentType="text/html;charset=euc-kr" %><%@ page import="com.oreilly.servlet.*" %><%@ page import="com.oreilly.servlet.multipart.*" %><jsp:useBean id="Board" scope="request" class="Bean.admin.BoardType1"/><jsp:useBean id="FrontBoard" scope="request" class="Bean.Front.Common.FrontBoradType1"/><%@ include file="../inc/requestSecurity.jsp" %><%	try	{		String savePath = application.getRealPath("/upload/board3"); //폴더 얻기		int sizeLimit = 30 * 1024 * 1024 ; // 5메가까지 제한 넘어서면 예외발생		MultipartRequest multi = new MultipartRequest(request, savePath, sizeLimit, "euc-kr", new DefaultFileRenamePolicy());		//    	// Object define : request.getParameter    	//    	String mode = multi.getParameter("mode");    	String PAGE = multi.getParameter("PAGE");		if(PAGE == null || PAGE.equals("")) {			PAGE = "1";		}		String KEY = multi.getParameter("KEY");	//검색어    	if(KEY != null && !KEY.equals("")) {    		KEY = StringReplace.sqlFilter(KEY);		//금지어 필터링    	}    	//out.println("KEY : " + KEY + "<br>");    	String FIELD = multi.getParameter("FIELD");	//검색구분    	String sh_no = multi.getParameter("sh_seq_no");		//out.println("sh_no : " + sh_no + "<br>");      	String file_no = multi.getParameter("file_no");		///////////////////////////////////////////////////		Vector vtsheet = new Vector();		if(mode.equals("del")) {			vtsheet.addElement("delete from sh_board1 where sh_no= " + sh_no);		}else if(mode.equals("filedel")) {			vtsheet.addElement("delete from sh_board_file3 where sh_no= " + sh_no + " and file_no= " + file_no);		}		///////////////////////////////////////////////////		String TableName = " sh_board_file3 ";	   	String SelectCondition = " file_no, sh_no, file_name, file_size, file_count ";	   	String WhereCondition  = "";	   	if(mode.equals("del")){			WhereCondition  = " where sh_no =  " + Integer.parseInt(sh_no);		}else if(mode.equals("filedel")){			WhereCondition  = " where sh_no =  " + Integer.parseInt(sh_no) + " and file_no = " + Integer.parseInt(file_no);		}		String OrderCondition  = " ORDER BY file_no ";		Vector ResultVector = FrontBoard.list(TableName, SelectCondition, WhereCondition, OrderCondition, 1, 0, 0);		if( ResultVector.size() > 0){			for (int i=0; i < ResultVector.size();i++){				Hashtable h = (Hashtable)ResultVector.elementAt(i);				String file_name = (String)h.get("FILE_NAME");				String fileUrl = savePath + "\\" + file_name;				//out.println("fileUrl : " + fileUrl + "<br>");				new File(fileUrl).delete();       			/*ServletContext cxt = getServletConfig().getServletContext();       			String file = cxt.getRealPath(fileUrl);       			File fileEx = new File(file);       			if(fileEx.exists()) {        			fileEx.delete();       			}*/			}		}		///////////////////////////////////////////////////		//		// Branch to process		//		String Result = null;		String msg = "";		if(mode.equals("del")){			msg = "삭제";			Result = Board.DataProcess(vtsheet);		}else if(mode.equals("filedel")){			msg = "파일이 삭제";			Result = Board.DataProcess(vtsheet);		}		///////////////////////////////////////////////////		//		// Veryification of Function and Redirect URL		//		if (Result.equals("True")){%>	        <script language="javascript">	        <!--	        	//document.location.href = "cal.jsp";	        	alert("<%=msg%>" +  " 되었습니다.");	        	<% if(mode.equals("del")){ %>					self.location = "commodity.jsp?PAGE=<%=PAGE%>&FIELD=<%=FIELD%>&KEY=<%=KEY%>";				<% }else if(mode.equals("filedel")){ %>					self.location = "commodity_write.jsp?mode=edit&sh_seq_no=<%=sh_no%>&PAGE=<%=PAGE%>&FIELD=<%=FIELD%>&KEY=<%=KEY%>";				<% } %>	        //-->	        </script><%		}else{%>	        <script language="javascript">	        <!--				alert("<%=msg%>" + "되지 않았습니다. \n\n 관리자에게 문의바랍니다.");				history.go(-1);	        //-->	        </script><%        }	} catch(Exception e) {		out.println("commodity_del_proc.jsp : " + e.getMessage());	} finally {	}%>