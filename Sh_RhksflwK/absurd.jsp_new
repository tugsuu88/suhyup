<%@ page import="java.util.*, util.*, Bean.Common.*" contentType="text/html;charset=euc-kr"%>

<%@ include file="include/manager_session.jsp" %>
<%@ include file="include/logincheck.jsp" %>
<%@ include file="include/top_login.jsp" %>
<%@ include file="include/top_menu05.jsp" %>



<jsp:useBean id="FrontBoard" scope="session" class="Bean.Front.Common.FrontBoradType1"/>
<jsp:useBean id="FrontDbUtil" scope="session" class="Bean.Front.Common.FrontDbUtil"/>

<%
Vector ResultVector;

String ListPage = Converter.nullchk(request.getParameter("ListPage"));
//String pageNum = request.getParameter("pageNum");
String myPage = request.getRequestURI();
String finance_buseo = "";
if (session.getAttribute("buseo") != null)
	finance_buseo=Converter.nullchk((String)session.getAttribute("buseo"));

try
{
String cmd = Converter.nullchk(request.getParameter("cmd"));	//검색어
String KEY = Converter.nullchk(request.getParameter("KEY"));	//검색어
if(KEY != null && !KEY.equals("")) {
KEY = StringReplace.sqlFilter(KEY);		//금지어 필터링
}
//out.println("KEY : " + KEY + "<br>");
String FIELD = Converter.nullchk(request.getParameter("FIELD"));	//검색구분
String startday=Converter.nullchk(request.getParameter("startday"));
String endday=Converter.nullchk(request.getParameter("endday"));
String status=Converter.nullchk(request.getParameter("status"));
String buse_name=Converter.nullchk(request.getParameter("buse_name"));
String result=Converter.nullchk(request.getParameter("result"));

int PAGE = 1;

///////////////////////////////////////////////////////////////////////////
String TableName = " sh_financetrouble ";
String SelectCondition = null;
String WhereCondition = null;
String OrderCondition = null;

if (request.getParameter("PAGE") == null || ((String)request.getParameter("PAGE")).equals("")){
PAGE = 1;
}else{
PAGE = Integer.parseInt(request.getParameter("PAGE"));
}

SelectCondition = " parcode,thid, name,title,publication,code,result,buseo,";
SelectCondition += "to_char(time1, 'YYYY-MM-DD') AS time1, to_char(time2, 'YYYY-MM-DD') AS time2, to_char(abandon_date, 'YYYY-MM-DD') AS abandon_date ";
OrderCondition  = " ORDER BY thid DESC";
WhereCondition=" where parcode=2 ";
if(!(finance_buseo.equals("감사실") || finance_buseo.equals("감사부")) &&  !finance_buseo.equals("금융소비자보호본부") &&  !finance_buseo.equals("조합감사실")){
WhereCondition+=" and buseo='" + finance_buseo + "' ";
}
if(finance_buseo.equals("금융소비자보호본부")){
WhereCondition+=" and junbuseo='Y' ";
}

if(cmd.equals("search")){
if(!startday.equals("") && !endday.equals("")){
WhereCondition+=" and to_char(time1,'YYYY-MM-DD')>='" + startday + "' and to_char(time1, 'YYYY-MM-DD')<='" + endday + "'";
}
if(!status.equals("")){
WhereCondition+=" and code='" + status + "'";
}
if(!buse_name.equals("")){
WhereCondition+=" and buseo='" + buse_name + "'";
}
if(!result.equals("")){
WhereCondition+=" and result='" + result + "'";
}
if(!FIELD.equals("")){
WhereCondition+=" and " + FIELD + " like '%" + KEY + "%'";
}
else{
WhereCondition+=" and (title like '%" + KEY + "%' or name like '%" + KEY + "%' or text like '%" + KEY + "%')";
}
}

int StartRecord = 0;
int EndRecord   = 0;
int DefaultListRecord = 10;
int DefaultPageBlock = 10;

int TotalRecordCount = FrontBoard.TotalCount(TableName, WhereCondition);
//out.print("TotalRecordCount : " + TotalRecordCount + "<br><br>");
///////////////////////////////////////////////////////////////////////////
%>
<script language="javascript" src="js/common.js"></script>
<script language="javascript">
  <!--
  function GoReg(){
    if(!pbform.startday.value){
      if(pbform.endday.value){
        alert("시작일을 넣어주세요");
        pbform.startday.focus();
        return;
      }
    }
    if(pbform.startday.value){
      if(!pbform.endday.value){
        alert("종료일을 넣어주세요");
        pbform.endday.focus();
        return;
      }
    }

    if(!compareDt(pbform.startday.value, pbform.endday.value)){
      alert("시작일은 종료일을 넘을 수 없습니다.");
      return;
    }

    if(!pbform.startday.value && !pbform.buse_name.value && !pbform.status.value && !pbform.result.value ){
      /*
      if(!pbform.FIELD.value){
          alert("조회구분을 해주세요");
          pbform.FIELD.focus();
          return;
      }
      */
      if(!pbform.KEY.value){
        alert("검색어를 적어주세요");
        pbform.KEY.focus();
        return;
      }
    }

    pbform.cmd.value = "search";
    pbform.submit();

  }

  function goView(thid,PAGE){
    pbform.thid.value=thid;
    pbform.PAGE.value=PAGE;
    pbform.action = "absurd_view.jsp";
    pbform.submit();
  }
  function goDetailView(thid,PAGE){
    pbform.thid.value=thid;
    pbform.PAGE.value=PAGE;
    pbform.action = "absurd_detail.jsp";
    pbform.submit();
  }

  //-->
</script>
<!-- 금융부조리 제보 설명 -->
<form method=post name="pbform" action="" style="margin:0px;">
    <div class="noti-wrap">
        <p> 본 신고의 내용과 요건에 따라 「공익신고자 보호법」, 「부패방지권익위법」 등에 따른 부패·공익신고에 해당할 경우, <em>신고사항의 조사·처리 과정에서 신고자 비밀보호에 각별히 유의</em>하시기 바라며, 조사결과 공익침해행위, 부패행위가 발견되기 전에는 <em>피신고자의 인적사항과 신고내용도 공개되어서는 안 됩니다.</em>
        </p>
        <ul>
            <li>※ 「공익신고자 보호법」 제2조(정의), 제8조(공익신고의 방법), 제10조제5항(공익신고의 처리), 제12조(공익신고자등의 비밀보장 의무) 및 제30조(벌칙)</li>
            <li>※ 「부패방지권익위법」 제64조(신고자의 비밀보장) 및 제88조(인적사항 공개 등 금지 위반의 죄)</li>
        </ul>
    </div>
    <div class="list-header">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td rowspan="2" class="admin_subject">금융부조리신고</td>
                <td class="bluesky">신청일</td>
                <td>
                    <input type="text" class="input01" size="10" name="startday" value=""><a href="javascript:Calendar(pbform.startday);"><img src="img/btn_calender.gif" width="23" height="18" align="absmiddle" border="0"></a>
                    ~
                    <input type="text" class="input01" size="10" name="endday" value=""><a href="javascript:Calendar(pbform.endday);"><img src="img/btn_calender.gif" width="23" height="18" align="absmiddle" border="0"></a>
                </td>
                <td class="bluesky">처리상태</td>
                <td>
                    <select name="status">
                        <option value="">선택</option>
                        <option value="신청"
                        <%if(status.equals("신청")) { %>selected<% } %>>신청</option>
                        <option value="접수"
                        <%if(status.equals("접수")) { %>selected<% } %>>접수</option>
                        <option value="이첩"
                        <%if(status.equals("이첩")) { %>selected<% } %>>이첩</option>
                        <option value="반송"
                        <%if(status.equals("반송")) { %>selected<% } %>>반송</option>
                        <option value="처리중"
                        <%if(status.equals("처리중")) { %>selected<% } %>>처리중</option>
                        <option value="답변완료"
                        <%if(status.equals("답변완료")) { %>selected<% } %>>답변완료</option>
                        <option value="민원철회"
                        <%if(status.equals("민원철회")) { %>selected<% } %>>민원철회</option>
                        <!-- -->
                    </select>
                </td>
                <td class="bluesky">처리결과</td>
                <td>
                    <select name="result">
                        <option value="">선택</option>
                        <option value="조치/시정"
                        <%if(result.equals("조치/시정")) { %>selected<% } %>>조치/시정</option>
                        <option value="절차안내"
                        <%if(result.equals("절차안내")) { %>selected<% } %>>절차안내</option>
                        <option value="합의/조정"
                        <%if(result.equals("합의/조정")) { %>selected<% } %>>합의/조정</option>
                        <option value="설득이해"
                        <%if(result.equals("설득이해")) { %>selected<% } %>>설득이해</option>
                        <option value="법령/제도상불능"
                        <%if(result.equals("법령/제도상불능")) { %>selected<% } %>>법령/제도상불능</option>
                        <option value="내용불합리"
                        <%if(result.equals("내용불합리")) { %>selected<% } %>>내용불합리</option>
                        <option value="재정"
                        <%if(result.equals("재정")) { %>selected<% } %>>재정</option>
                        <option value="사실상이"
                        <%if(result.equals("사실상이")) { %>selected<% } %>>사실상이</option>
                        <option value="사적분쟁"
                        <%if(result.equals("사적분쟁")) { %>selected<% } %>>사적분쟁</option>
                        <option value="소송/수사"
                        <%if(result.equals("소송/수사")) { %>selected<% } %>>소송/수사</option>
                        <option value="불문(민원아님)"
                        <%if(result.equals("불문(민원아님)")) { %>selected<% } %>>불문(민원아님)</option>
                        <option value="건의/검토"
                        <%if(result.equals("건의/검토")) { %>selected<% } %>>건의/검토</option>
                        <!-- -->
                    </select>
                </td>
            </tr>
            <tr>
                <td class="bluesky">담당부서</td>
                <td>
                    <select name="buse_name">
                        <option value="">선택</option>
                        <% //Vector ResultVector;
                        
                        String TableNameBuseo = " sh_buseo "; String SelectCondition1 = " BUSEO_CD, BUSEO_NM"; String WhereCondition1 = "where 1 = 1 ";
                        String OrderCondition1 = "";
                        
                        ResultVector = FrontBoard.list(TableNameBuseo, SelectCondition1, WhereCondition1, OrderCondition1, 1, 0, 100);
                        
                        String sh_buseo_cd = ""; String sh_buseo_nm = "";
                        
                        if( ResultVector.size() > 0){ for (int i=0; i < ResultVector.size();i++){
                        
                        Hashtable h = (Hashtable)ResultVector.elementAt(i);
                        
                        sh_buseo_cd = (String)h.get("BUSEO_CD"); sh_buseo_nm = (String)h.get("BUSEO_NM");
                        
                        %>
                        
                        <%if(buse_name.equals(sh_buseo_cd)){ %>
                        <option value="<%=xss_Check(sh_buseo_cd)%>" selected id="selectBuseo">
                            <% } else { %>
                        <option value="<%=xss_Check(sh_buseo_cd)%>" id="selectBuseo">
                            <% } %> <%=xss_Check(sh_buseo_nm)%>
                        </option>
                        
                        <% } %> <% } %>
                        
                        <%--
                        <option value="감사실"
                        <%if(buse_name.equals("감사실")) { %>selected<% } %>>감사실</option>
                        <option value="감사부"
                        <%if(buse_name.equals("감사부")) { %>selected<% } %>>감사부</option>
                        <option value="IT관리실"
                        <%if(buse_name.equals("IT관리실")) { %>selected<% } %>>IT관리실</option>
                        <option value="인사총무부"
                        <%if(buse_name.equals("인사총무부")) { %>selected<% } %>>인사총무부</option>
                        <option value="개인금융부"
                        <%if(buse_name.equals("개인금융부")) { %>selected<% } %>>개인금융부</option>
                        <option value="공제보험부"
                        <%if(buse_name.equals("공제보험부")) { %>selected<% } %>>공제보험부</option>
                        <option value="전략기획부"
                        <%if(buse_name.equals("전략기획부")) { %>selected<% } %>>전략기획부</option>
                        <option value="기획부"
                        <%if(buse_name.equals("기획부")) { %>selected<% } %>>기획부</option>
                        <option value="노량진시장 현대화사업본부"
                        <%if(buse_name.equals("노량진시장 현대화사업본부")) { %>selected<% } %>>노량진시장 현대화사업본부</option>
                        <option value="단체급식사업단"
                        <%if(buse_name.equals("단체급식사업단")) { %>selected<% } %>>단체급식사업단</option>
                        <option value="리스크관리본부"
                        <%if(buse_name.equals("리스크관리본부")) { %>selected<% } %>>리스크관리본부</option>
                        <option value="고객자산관리부(펀드)"
                        <%if(buse_name.equals("고객자산관리부(펀드)")) { %>selected<% } %>>고객자산관리부(펀드)</option>
                        <option value="상호금융부"
                        <%if(buse_name.equals("상호금융부")) { %>selected<% } %>>상호금융부</option>
                        <option value="수산경제연구원"
                        <%if(buse_name.equals("수산경제연구원")) { %>selected<% } %>>수산경제연구원</option>
                        <option value="수산금융부"
                        <%if(buse_name.equals("수산금융부")) { %>selected<% } %>>수산금융부</option>
                        <option value="가공물류부"
                        <%if(buse_name.equals("가공물류부")) { %>selected<% } %>>가공물류부</option>
                        <option value="신탁사업본부"
                        <%if(buse_name.equals("신탁사업본부")) { %>selected<% } %>>신탁사업본부</option>
                        <option value="심사부"
                        <%if(buse_name.equals("심사부")) { %>selected<% } %>>심사부</option>
                        <!--                    <option value="안전관리실" <%if(buse_name.equals("안전관리실")) { %>selected<% } %>>안전관리실</option>
                          -->
                        <option value="어업정보통신본부"
                        <%if(buse_name.equals("어업정보통신본부")) { %>selected<% } %>>어업정보통신본부</option>
                        <option value="여신관리부"
                        <%if(buse_name.equals("여신관리부")) { %>selected<% } %>>여신관리부</option>
                        <option value="연수원"
                        <%if(buse_name.equals("연수원")) { %>selected<% } %>>연수원</option>
                        <option value="글로벌외환사업부"
                        <%if(buse_name.equals("글로벌외환사업부")) { %>selected<% } %>>글로벌외환사업부</option>
                        <option value="경제기획부"
                        <%if(buse_name.equals("경제기획부")) { %>selected<% } %>>경제기획부</option>
                        <option value="이사회사무국"
                        <%if(buse_name.equals("이사회사무국")) { %>selected<% } %>>이사회사무국</option>
                        <option value="자금부"
                        <%if(buse_name.equals("자금부")) { %>selected<% } %>>자금부</option>
                        <option value="자재사업부"
                        <%if(buse_name.equals("자재사업부")) { %>selected<% } %>>자재사업부</option>
                        <option value="IT개발부"
                        <%if(buse_name.equals("IT개발부")) { %>selected<% } %>>IT개발부</option>
                        <option value="정보보호본부"
                        <%if(buse_name.equals("정보보호본부")) { %>selected<% } %>>정보보호본부</option>
                        <option value="조합감사실"
                        <%if(buse_name.equals("조합감사실")) { %>selected<% } %>>조합감사실</option>
                        <option value="리스크관리실"
                        <%if(buse_name.equals("리스크관리실")) { %>selected<% } %>>리스크관리실</option>
                        <option value="자금운용부"
                        <%if(buse_name.equals("자금운용부")) { %>selected<% } %>>자금운용부</option>
                        <option value="준법감시팀"
                        <%if(buse_name.equals("준법감시팀")) { %>selected<% } %>>준법감시팀</option>
                        <option value="판매사업부"
                        <%if(buse_name.equals("판매사업부")) { %>selected<% } %>>판매사업부</option>
                        <option value="총무부"
                        <%if(buse_name.equals("총무부")) { %>selected<% } %>>총무부</option>
                        <option value="카드사업부"
                        <%if(buse_name.equals("카드사업부")) { %>selected<% } %>>카드사업부</option>
                        <option value="해양투자금융센터"
                        <%if(buse_name.equals("해양투자금융센터")) { %>selected<% } %>>해양투자금융센터</option>
                        <option value="홍보실"
                        <%if(buse_name.equals("홍보실")) { %>selected<% } %>>홍보실</option>
                        <option value="회원지원부"
                        <%if(buse_name.equals("회원지원부")) { %>selected<% } %>>회원지원부</option>
                        <option value="사업구조개편단"
                        <%if(buse_name.equals("사업구조개편단")) { %>selected<% } %>>사업구조개편단</option>
                        <option value="기업금융부"
                        <%if(buse_name.equals("기업금융부")) { %>selected<% } %>>기업금융부</option>
                        <option value="여신정책부"
                        <%if(buse_name.equals("여신정책부")) { %>selected<% } %>>여신정책부</option>
                        <option value="정책보험부"
                        <%if(buse_name.equals("정책보험부")) { %>selected<% } %>>정책보험부</option>
                        <option value="금융소비자보호본부"
                        <%if(buse_name.equals("금융소비자보호본부")) { %>selected<% } %>>금융소비자보호본부</option>
                        <option value="디지털금융부"
                        <%if(buse_name.equals("디지털금융부")) { %>selected<% } %>>디지털금융부</option>
                        <option value="선원지원실"
                        <%if(buse_name.equals("선원지원실")) { %>selected<% } %>>선원지원실</option>
                        <option value="준법감시실(중앙회)"
                        <%if(buse_name.equals("준법감시실(중앙회)")) { %>selected<% } %>>준법감시실(중앙회)</option>
                        <option value="준법감시실(조합)"
                        <%if(buse_name.equals("준법감시실(조합)")) { %>selected<% } %>>준법감시실(조합)</option> --%>
                    </select>
                </td>
                <td class="bluesky">조회구분</td>
                <td colspan="4">
                    <select name="FIELD">
                        <option value="">선택</option>
                        <option value="title">제목</option>
                        <option value="text">내용</option>
                        <option value="name">민원인</option>
                        <!-- -->
                    </select>
                    <input type="text" class="input01" size="48" style="width: 180px" name="KEY" value="<%=KEY%>">
                    <a href="javascript:GoReg();"><img src="img/btn_search.gif" width="38" height="17" border="0" alt="검색"></a>
                    <a href="javascript:pbform.reset();"><img src="img/btn_refresh.gif" width="48" height="17" border="0" alt="초기화"></a>
                </td>
            </tr>
        </table>
    </div>
    <!-- // 금융부조리 제보 설명 -->
    <br>
    <div class="tbl-wrap">
        <!-- 검색결과 -->
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td height="30"><img src="img/result.gif" align="absmiddle"> 검색결과 :
                    <span class="result_text">총 <%=TotalRecordCount %>건</span></td>
                <td height="30" align="right"><a href="excel/absurd_excel.jsp?cmd=<%=xss_Check(cmd)%>&KEY=<%=KEY%>&FIELD=<%=xss_Check(FIELD)%>&startday=<%=xss_Check(startday)%>&endday=<%=xss_Check(endday)%>&status=<%=xss_Check(status)%>&buse_name=<%=xss_Check(buse_name)%>&result=<%=xss_Check(result)%>"><img src="img/btn_excel.gif" width="66" height="21" alt="엑셀" border="0"></a></td>
            </tr>
        </table>
        <div class="subtit"><img src="img/arrow.gif" width="13" height="16" align="absmiddle">금융부조리 신고</div>
        <!-- // 검색결과 -->

        <table border="0" cellspacing="0" cellpadding="0" class="tbl-list">
            <tr height="30" class="header">
                <td class="board_bg_title" align="center">번호</td>
                <td class="board_bg_title" align="center">특수코드</td>
                <td class="board_bg_title" align="center">제목</td>
                <td class="board_bg_title" align="center">민원인</td>
                <td class="board_bg_title" align="center">신청일</td>
                <td class="board_bg_title" align="center">처리상태</td>
                <td class="board_bg_title" align="center">담당부서</td>
                <!--
                          <td class="board_bg_title" width="75" align="center">처리결과</td>
                -->
                <td class="board_bg_title" align="center">답변일</td>
            </tr>
            <%
            ResultVector = FrontBoard.list(TableName, SelectCondition, WhereCondition, OrderCondition, PAGE, 0, DefaultListRecord);
            
            if( ResultVector.size() > 0){
            for (int i=0; i < ResultVector.size();i++){
            Hashtable h = (Hashtable)ResultVector.elementAt(i);
            
            String TITLE = (String)h.get("TITLE");	//제목
            if (TITLE.length() > 31){
            TITLE = TITLE.substring(0,31);
            TITLE += "...";
            }
            //int listnum = DefaultListRecord * (PAGE - 1) + i + 1;	 //글번호 계산
            int listnum = (TotalRecordCount) - (i + (DefaultListRecord * (PAGE - 1)));	//글번호 계산(역순)
            String time2=(String)h.get("TIME2");
            String code=(String)h.get("CODE");
            
            String PUBLICATION = (String)h.get("PUBLICATION");
    	    if ( PUBLICATION != null ) {
    			PUBLICATION = PUBLICATION.replaceAll("<","&lt;");
    			PUBLICATION = PUBLICATION.replaceAll(">","&gt;");
    		} else {
    			PUBLICATION = "";
    		}
    	    
    	    String TIME1 = (String)h.get("TIME1");
    	    if ( TIME1 != null ) {
    			TIME1 = TIME1.replaceAll("<","&lt;");
    			TIME1 = TIME1.replaceAll(">","&gt;");
    		} else {
    			TIME1 = "";
    		}
    	    
    	    String RESULT = (String)h.get("RESULT");   
    	    if ( RESULT != null ) {
    			RESULT = RESULT.replaceAll("<","&lt;");
    			RESULT = RESULT.replaceAll(">","&gt;");
    		} else {
    			RESULT = "";
    		}
            
            %>
            <tr height="30">
                <td align="center"><%=listnum %></td>
                <td align="center"><%=PUBLICATION %></td>
                <td style="padding-left:10;">
                    <%if(time2==null || time2.equals("")){%>
                    <a href="javascript:goView('<%=xss_Check((String)h.get("THID"))%>',<%= xss_Check(PAGE) %>);"><%=xss_Check(TITLE) %></a>
                    <%}else{%>
                    <a href="javascript:goDetailView('<%=xss_Check((String)h.get("THID"))%>',<%= xss_Check(PAGE) %>);"><%= xss_Check(TITLE) %></a>
                    <%} %>
                </td>
                <td align="center"><%=xss_Check((String)h.get("NAME"))%></td>
                <td align="center"><%=TIME1 %></td>
                <td align="center"><%=xss_Check(code) %></td>
                <td align="center"><%=xss_Check((String)h.get("BUSEO"))%></td>
                <!--
                          <td align="center"><%=RESULT %></td>
                -->
                <%if("철회완료".equals(code)){ %>
                <td align="center"><%=xss_Check((String)h.get("ABANDON_DATE"))%></td>
                <%}else{ %>
                <td align="center"><%=xss_Check(time2)%></td>
                <%} %>
            </tr>
            <%
            }
            } else {
            %>
            <tr>
                <td class="no" align="center" colspan="9">등록 자료가 없습니다.</td>
            </tr>
            <%
            }
            %>
        </table>
        <br>
        <!-- // 리스트 -->
        <!-- 페이지 넘버링 -->
        <table width="945" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td align="center">
                    <% if(TotalRecordCount > 0) { %>
                    <%=FrontDbUtil.PrintPage(Integer.toString(PAGE), TotalRecordCount, DefaultListRecord, DefaultPageBlock, "absurd.jsp?KEY="+KEY+"&cmd=" + cmd + "&FIELD=" + FIELD + "&startday=" + startday + "&endday=" + endday + "&status=" + status + "&buse_name=" + buse_name + "&PAGE=","<img src=img/board_prev.gif width=13 height=13 align=absmiddle border=0>","<img src=img/board_next.gif width=13 height=13 align=absmiddle border=0>")%>
                    <% } %>
                </td>
            </tr>
        </table>
                    <!-- 페이지 넘버링 -->
        <input type="hidden" name="cmd">
        <input type="hidden" name="thid">
        <input type="hidden" name="PAGE">
    </div>
</form>
<%@ include file="include/bottom.jsp" %>
<%
} catch(Exception e) {
	Log.message(e.getMessage());
}
%>